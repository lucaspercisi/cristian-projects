{% extends "base.html" %}

{% block title %}Análise de Faturamento{% endblock %}

{% block page_title %}Análise de Faturamento{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-xl shadow-2xl transition-all duration-300">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-600 pb-2">Cotação e Análise de Fretes</h2>
    <p class="text-sm text-gray-600 mb-6">Insira as informações de cotação de cada transportadora para analisar a melhor opção de preço e prazo.</p>

    <form id="cotacaoForm" class="space-y-6">

        <div class="border border-gray-200 rounded-lg p-6 bg-gray-50">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Transportadora 1</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="transportadora1" class="block text-sm font-medium text-gray-700">Nome da Transportadora</label>
                    <input type="text" id="transportadora1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
                <div>
                    <label for="prazo1" class="block text-sm font-medium text-gray-700">Prazo de Entrega (dias)</label>
                    <input type="number" id="prazo1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
                <div>
                    <label for="valor1" class="block text-sm font-medium text-gray-700">Custo do Frete (R$)</label>
                    <input type="number" step="0.01" id="valor1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
            </div>
        </div>

        <div class="border border-gray-200 rounded-lg p-6 bg-gray-50">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Transportadora 2</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="transportadora2" class="block text-sm font-medium text-gray-700">Nome da Transportadora</label>
                    <input type="text" id="transportadora2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
                <div>
                    <label for="prazo2" class="block text-sm font-medium text-gray-700">Prazo de Entrega (dias)</label>
                    <input type="number" id="prazo2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
                <div>
                    <label for="valor2" class="block text-sm font-medium text-gray-700">Custo do Frete (R$)</label>
                    <input type="number" step="0.01" id="valor2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
            </div>
        </div>
        
        <div class="border border-gray-200 rounded-lg p-6 bg-gray-50">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Transportadora 3</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="transportadora3" class="block text-sm font-medium text-gray-700">Nome da Transportadora</label>
                    <input type="text" id="transportadora3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
                <div>
                    <label for="prazo3" class="block text-sm font-medium text-gray-700">Prazo de Entrega (dias)</label>
                    <input type="number" id="prazo3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
                <div>
                    <label for="valor3" class="block text-sm font-medium text-gray-700">Custo do Frete (R$)</label>
                    <input type="number" step="0.01" id="valor3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 sm:text-sm p-2">
                </div>
            </div>
        </div>

        <div class="flex justify-end space-x-4 mt-6">
            <button type="button" onclick="analisarCotacoes()" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">
                Analisar
            </button>
        </div>

        <div id="analiseResultados" class="hidden mt-8 border-t-2 border-gray-300 pt-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Resultado da Análise</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-green-100 p-4 rounded-lg shadow-md border-2 border-green-500">
                    <h4 class="text-lg font-semibold text-green-700">Melhor Preço</h4>
                    <p id="melhorPreco" class="mt-2 text-2xl font-bold text-green-900"></p>
                </div>
                <div class="bg-blue-100 p-4 rounded-lg shadow-md border-2 border-blue-500">
                    <h4 class="text-lg font-semibold text-blue-700">Melhor Prazo</h4>
                    <p id="melhorPrazo" class="mt-2 text-2xl font-bold text-blue-900"></p>
                </div>
            </div>
        </div>

    </form>
</div>

<script>
    function analisarfaturamento() {
        const faturamento = [
            { transportadora: document.getElementById('transportadora1').value, prazo: parseFloat(document.getElementById('prazo1').value), valor: parseFloat(document.getElementById('valor1').value) },
            { transportadora: document.getElementById('transportadora2').value, prazo: parseFloat(document.getElementById('prazo2').value), valor: parseFloat(document.getElementById('valor2').value) },
            { transportadora: document.getElementById('transportadora3').value, prazo: parseFloat(document.getElementById('prazo3').value), valor: parseFloat(document.getElementById('valor3').value) }
        ];

        let melhorPreco = null;
        let melhorPrazo = null;

        faturamento.forEach(c => {
            if (c.valor && (melhorPreco === null || c.valor < melhorPreco.valor)) {
                melhorPreco = c;
            }
            if (c.prazo && (melhorPrazo === null || c.prazo < melhorPrazo.prazo)) {
                melhorPrazo = c;
            }
        });

        const resultadosDiv = document.getElementById('analiseResultados');
        resultadosDiv.classList.remove('hidden');

        if (melhorPreco) {
            document.getElementById('melhorPreco').textContent = `${melhorPreco.transportadora}: R$ ${melhorPreco.valor.toFixed(2)}`;
        } else {
            document.getElementById('melhorPreco').textContent = 'Nenhuma cotação de preço encontrada.';
        }

        if (melhorPrazo) {
            document.getElementById('melhorPrazo').textContent = `${melhorPrazo.transportadora}: ${melhorPrazo.prazo} dias`;
        } else {
            document.getElementById('melhorPrazo').textContent = 'Nenhuma cotação de prazo encontrada.';
        }
    }
</script>
{% endblock %}